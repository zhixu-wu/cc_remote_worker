# Remote Worker å¿«é€Ÿå¼€å§‹æŒ‡å—

## 5åˆ†é’Ÿä¸Šæ‰‹

### æ­¥éª¤1: é…ç½®æœåŠ¡å™¨ä¿¡æ¯

**é¦–æ¬¡ä½¿ç”¨**:
```bash
# å¤åˆ¶é…ç½®æ¨¡æ¿
cp servers.conf.template servers.conf

# ç¼–è¾‘é…ç½®æ–‡ä»¶
vim servers.conf  # æˆ–ä½¿ç”¨ä½ å–œæ¬¢çš„ç¼–è¾‘å™¨
```

**é…ç½®æ ¼å¼**:
```
# åˆ«å|ä¸»æœºIP|SSHç«¯å£|ç”¨æˆ·å|å¯†ç 
hawkbit|192.168.77.142|22|hawkbit|YourPassword
prod|10.0.0.100|22|admin|SecretPass
```

### æ­¥éª¤2: æµ‹è¯•è¿æ¥

```bash
# æŸ¥çœ‹å¯ç”¨æœåŠ¡å™¨
./ssh_exec.sh

# æµ‹è¯•è¿æ¥
./ssh_exec.sh hawkbit "pwd"
```

### æ­¥éª¤3: å¼€å§‹è¿ç»´ä»»åŠ¡

**ç¤ºä¾‹: æ£€æŸ¥DockeræœåŠ¡**
```bash
./ssh_exec.sh hawkbit "docker ps"
```

**ç¤ºä¾‹: æŸ¥çœ‹æ—¥å¿—**
```bash
./ssh_exec.sh prod "tail -100 /var/log/nginx/error.log"
```

**ç¤ºä¾‹: é‡å¯æœåŠ¡**
```bash
# æ³¨æ„: é«˜é£é™©æ“ä½œéœ€è¦ç”¨æˆ·ç¡®è®¤
./ssh_exec.sh prod "sudo systemctl restart nginx"
```

---

## å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

### Dockerç›¸å…³
```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
./ssh_exec.sh <alias> "docker ps"

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
./ssh_exec.sh <alias> "docker logs <container_name> --tail 100"

# é‡å¯å®¹å™¨
./ssh_exec.sh <alias> "docker restart <container_name>"

# æŸ¥çœ‹å®¹å™¨å¥åº·çŠ¶æ€
./ssh_exec.sh <alias> "docker inspect <container_name> --format='{{.State.Health.Status}}'"
```

### Nginxç›¸å…³
```bash
# æµ‹è¯•é…ç½®
./ssh_exec.sh <alias> "docker exec <nginx_container> nginx -t"

# é‡è½½é…ç½®
./ssh_exec.sh <alias> "docker exec <nginx_container> nginx -s reload"

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
./ssh_exec.sh <alias> "docker logs <nginx_container> --tail 50 2>&1 | grep error"
```

### ç³»ç»Ÿç›‘æ§
```bash
# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
./ssh_exec.sh <alias> "df -h"

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
./ssh_exec.sh <alias> "free -h"

# æŸ¥çœ‹è¿›ç¨‹
./ssh_exec.sh <alias> "top -bn1 | head -20"

# æŸ¥çœ‹ç½‘ç»œè¿æ¥
./ssh_exec.sh <alias> "netstat -tulpn | grep LISTEN"
```

---

## å·¥ä½œæµç¨‹ç¤ºä¾‹

### åœºæ™¯1: çº¯è¿œç¨‹æœåŠ¡å™¨è¿ç»´ (ç±»å‹Aä»»åŠ¡)

**ä»»åŠ¡**: æ’æŸ¥ç”Ÿäº§ç¯å¢ƒNginx 502é”™è¯¯

**1. ä»»åŠ¡åˆå§‹åŒ–**
```
ç”¨æˆ·: æ’æŸ¥ç”Ÿäº§ç¯å¢ƒNginx 502é”™è¯¯
Claude: æœ¬æ¬¡ä»»åŠ¡å±äºå“ªç§ç±»å‹? A:çº¯è¿œç¨‹ B:æœ¬åœ°+è¿œç¨‹ C:çº¯æœ¬åœ°
ç”¨æˆ·: A
Claude: è¯·æä¾›SSHè¿æ¥ä¿¡æ¯...
```

**2. è¿æ¥æœåŠ¡å™¨**
```bash
./ssh_exec.sh prod "pwd"
# è¾“å‡º: /home/admin
```

**3. ä¿¡æ¯æ”¶é›†**
```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
./ssh_exec.sh prod "docker ps | grep nginx"

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
./ssh_exec.sh prod "docker logs nginx-prod --tail 100 2>&1 | grep '502\|error'"

# æ£€æŸ¥ä¸Šæ¸¸æœåŠ¡
./ssh_exec.sh prod "docker ps | grep backend"
```

**4. é—®é¢˜åˆ†æ**
```
ã€é—®é¢˜åˆ†æã€‘
- é—®é¢˜æ ¹å› : åç«¯æœåŠ¡containeré‡å¯å¯¼è‡´è¿æ¥ä¸­æ–­
- å½±å“èŒƒå›´: æ‰€æœ‰APIè¯·æ±‚è¿”å›502

ã€è§£å†³æ–¹æ¡ˆã€‘
æ–¹æ¡ˆA: é‡å¯Nginxå®¹å™¨ - å¿«é€Ÿä½†æ²»æ ‡ä¸æ²»æœ¬
æ–¹æ¡ˆB: ä¿®æ”¹Nginxå¥åº·æ£€æŸ¥é…ç½® - æ²»æœ¬,éœ€é‡æ–°éƒ¨ç½²

ã€æ¨èæ–¹æ¡ˆã€‘æ–¹æ¡ˆB
```

**5. æ‰§è¡Œæ–¹æ¡ˆ**
```bash
# å¤‡ä»½é…ç½®
./ssh_exec.sh prod "docker exec nginx-prod cat /etc/nginx/nginx.conf > /tmp/nginx.conf.bak"

# ä¿®æ”¹é…ç½®(æ·»åŠ å¥åº·æ£€æŸ¥)
# ... æ‰§è¡Œä¿®æ”¹æ“ä½œ ...

# é‡æ–°åŠ è½½
./ssh_exec.sh prod "docker exec nginx-prod nginx -s reload"
```

**6. éªŒè¯ç»“æœ**
```bash
./ssh_exec.sh prod "curl -I http://localhost/api/health"
# æ£€æŸ¥è¿”å›çŠ¶æ€ç : 200 OK
```

---

### åœºæ™¯2: æœ¬åœ°é¡¹ç›®è”åˆè¿œç¨‹æ’æŸ¥ (ç±»å‹Bä»»åŠ¡) ğŸ†•

**ä»»åŠ¡**: Spring Bootåº”ç”¨APIè¿”å›500é”™è¯¯

**1. ä»»åŠ¡åˆå§‹åŒ–**
```
ç”¨æˆ·: æ’æŸ¥ç”Ÿäº§ç¯å¢ƒAPI 500é”™è¯¯
Claude: æœ¬æ¬¡ä»»åŠ¡å±äºå“ªç§ç±»å‹? A:çº¯è¿œç¨‹ B:æœ¬åœ°+è¿œç¨‹ C:çº¯æœ¬åœ°
ç”¨æˆ·: B (éœ€è¦æŸ¥çœ‹ä»£ç )
Claude:
  1) è¯·æä¾›SSHè¿æ¥ä¿¡æ¯...
  2) è¯·æä¾›æœ¬åœ°é¡¹ç›®è·¯å¾„...
ç”¨æˆ·:
  1) ä½¿ç”¨prodæœåŠ¡å™¨
  2) /Users/username/projects/my-app
```

**2. éªŒè¯ç¯å¢ƒ**
```bash
# è¿æ¥è¿œç¨‹æœåŠ¡å™¨
./ssh_exec.sh prod "pwd"
# è¾“å‡º: /home/admin

# æ£€æŸ¥æœ¬åœ°é¡¹ç›®
ls /Users/username/projects/my-app
# è¾“å‡º: src/ pom.xml ...
```

**3. ä¿¡æ¯æ”¶é›†**

**æœ¬åœ°ä»£ç åˆ†æ:**
```bash
# å®šä½APIæ¥å£ä»£ç 
grep -r "uploadFile" /Users/username/projects/my-app/src

# æ‰¾åˆ°: src/main/java/com/example/controller/FileController.java:45
# æŸ¥çœ‹é…ç½®
cat /Users/username/projects/my-app/src/main/resources/application.yml
```

**è¿œç¨‹æ—¥å¿—æŸ¥çœ‹:**
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
./ssh_exec.sh prod "docker logs app-prod --tail 200 | grep -A 5 'uploadFile'"

# è¾“å‡ºé”™è¯¯:
# java.lang.IllegalStateException: File size exceeds maximum permitted size of 1MB
```

**4. å…³è”åˆ†æ**
```
ã€é—®é¢˜åˆ†æã€‘
- é—®é¢˜æ ¹å› : æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶é…ç½®ä¸ä¸€è‡´
- å½±å“èŒƒå›´: æ‰€æœ‰å¤§äº1MBçš„æ–‡ä»¶ä¸Šä¼ è¯·æ±‚
- ç›¸å…³ä»£ç ä½ç½®:
  - æœ¬åœ°: src/main/resources/application.yml:23 - spring.servlet.multipart.max-file-size=10MB
  - è¿œç¨‹æ—¥å¿—: app-prodå®¹å™¨ - é™åˆ¶ä¸º1MB

ã€æœ¬åœ°ä»£ç åˆ†æã€‘
- ä»£ç é€»è¾‘: FileControllerä½¿ç”¨Springé»˜è®¤multiparté…ç½®
- æ½œåœ¨é—®é¢˜ç‚¹: æœ¬åœ°é…ç½®ä¸º10MB,ä½†è¿œç¨‹ç¯å¢ƒæœªåŒæ­¥
- é…ç½®å·®å¼‚: æœ¬åœ°10MB vs è¿œç¨‹1MB

ã€è¿œç¨‹ç¯å¢ƒçŠ¶æ€ã€‘
- æœåŠ¡çŠ¶æ€: æ­£å¸¸è¿è¡Œ
- æ—¥å¿—å¼‚å¸¸: æ–‡ä»¶å¤§å°è¶…é™
- èµ„æºä½¿ç”¨: æ­£å¸¸

ã€è§£å†³æ–¹æ¡ˆã€‘
æ–¹æ¡ˆA: ä»…ä¿®æ”¹è¿œç¨‹é…ç½® - å¿«é€Ÿ,ä½†å¯èƒ½ä¸‹æ¬¡éƒ¨ç½²åˆä¸¢å¤± - æ¶‰åŠèŒƒå›´(è¿œç¨‹)
æ–¹æ¡ˆB: æ›´æ–°Dockeré•œåƒç¯å¢ƒå˜é‡å¹¶é‡æ–°éƒ¨ç½² - æŒä¹…åŒ–,æ¨è - æ¶‰åŠèŒƒå›´(è¿œç¨‹)

ã€æ¨èæ–¹æ¡ˆã€‘æ–¹æ¡ˆB
```

**5. æ‰§è¡Œæ–¹æ¡ˆ**
```bash
# [è¿œç¨‹] å¤‡ä»½docker-composeé…ç½®
./ssh_exec.sh prod "cp /home/admin/app/docker-compose.yml /home/admin/backups/docker-compose.yml.bak"

# [è¿œç¨‹] ä¿®æ”¹docker-compose.ymlæ·»åŠ ç¯å¢ƒå˜é‡
./ssh_exec.sh prod "cat >> /home/admin/app/docker-compose.yml <<'EOF'
    environment:
      - SPRING_SERVLET_MULTIPART_MAX_FILE_SIZE=10MB
      - SPRING_SERVLET_MULTIPART_MAX_REQUEST_SIZE=10MB
EOF"

# [è¿œç¨‹] é‡æ–°éƒ¨ç½²
./ssh_exec.sh prod "cd /home/admin/app && docker compose up -d --force-recreate app-prod"

# [è¿œç¨‹] ç­‰å¾…æœåŠ¡å¯åŠ¨
./ssh_exec.sh prod "sleep 10 && docker ps | grep app-prod"
```

**6. éªŒè¯ç»“æœ**
```
ã€éªŒè¯ç»“æœã€‘
âœ“ æœ¬åœ°éªŒè¯: é…ç½®æ–‡ä»¶application.ymlç¡®è®¤ä¸º10MB
âœ“ è¿œç¨‹éªŒè¯:
  - docker inspect app-prod | grep MAX_FILE_SIZE  # è¾“å‡º: 10MB
  - docker logs app-prod --tail 50  # æ— é”™è¯¯æ—¥å¿—
âœ“ å…³è”éªŒè¯:
  - æµ‹è¯•ä¸Šä¼ 5MBæ–‡ä»¶æˆåŠŸ
  - ç¡®è®¤ç¯å¢ƒå˜é‡å·²ç”Ÿæ•ˆ

è¯·ç¡®è®¤ä»¥ä¸ŠéªŒè¯é€šè¿‡?
```

**7. ä»»åŠ¡æ€»ç»“**
- æœ¬åœ°ä»£ç : æ— éœ€ä¿®æ”¹(é…ç½®æ­£ç¡®)
- è¿œç¨‹ç¯å¢ƒ: å·²åŒæ­¥é…ç½®è‡³10MB
- é—®é¢˜è§£å†³: API 500é”™è¯¯å·²ä¿®å¤

---

### åœºæ™¯3: çº¯æœ¬åœ°é¡¹ç›®åˆ†æ (ç±»å‹Cä»»åŠ¡) ğŸ†•

**ä»»åŠ¡**: åˆ†ææœ¬åœ°é¡¹ç›®æ„å»ºå¤±è´¥åŸå› 

**1. ä»»åŠ¡åˆå§‹åŒ–**
```
ç”¨æˆ·: æˆ‘çš„Mavené¡¹ç›®æ„å»ºå¤±è´¥äº†,å¸®æˆ‘çœ‹çœ‹
Claude: æœ¬æ¬¡ä»»åŠ¡å±äºå“ªç§ç±»å‹? A:çº¯è¿œç¨‹ B:æœ¬åœ°+è¿œç¨‹ C:çº¯æœ¬åœ°
ç”¨æˆ·: C (åªçœ‹æœ¬åœ°ä»£ç )
Claude: è¯·æä¾›æœ¬åœ°é¡¹ç›®è·¯å¾„...
ç”¨æˆ·: /Users/username/projects/my-maven-app
```

**2. éªŒè¯ç¯å¢ƒ**
```bash
# æ£€æŸ¥é¡¹ç›®ç»“æ„
tree /Users/username/projects/my-maven-app -L 2

# æŸ¥çœ‹pom.xml
cat /Users/username/projects/my-maven-app/pom.xml
```

**3. ä¿¡æ¯æ”¶é›†**
```bash
# å°è¯•æ„å»º
cd /Users/username/projects/my-maven-app && mvn clean package

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
# å‘ç°: ä¾èµ–å†²çª - jacksonç‰ˆæœ¬ä¸ä¸€è‡´
```

**4. é—®é¢˜åˆ†æ**
```
ã€é—®é¢˜åˆ†æã€‘
- é—®é¢˜æ ¹å› : pom.xmlä¸­jackson-coreå’Œjackson-databindç‰ˆæœ¬ä¸ä¸€è‡´
- å½±å“èŒƒå›´: æ— æ³•å®Œæˆæ„å»º

ã€è§£å†³æ–¹æ¡ˆã€‘
æ–¹æ¡ˆA: æ‰‹åŠ¨ç»Ÿä¸€jacksonç‰ˆæœ¬å·
æ–¹æ¡ˆB: ä½¿ç”¨dependencyManagementç®¡ç†ç‰ˆæœ¬(æ¨è)

ã€æ¨èæ–¹æ¡ˆã€‘æ–¹æ¡ˆB
```

**5. æ‰§è¡Œæ–¹æ¡ˆ**
```bash
# [æœ¬åœ°] å¤‡ä»½pom.xml
cp /Users/username/projects/my-maven-app/pom.xml /Users/username/projects/my-maven-app/pom.xml.bak

# [æœ¬åœ°] ä¿®æ”¹pom.xmlæ·»åŠ dependencyManagement
# ... æ‰§è¡Œä¿®æ”¹æ“ä½œ ...

# [æœ¬åœ°] é‡æ–°æ„å»º
cd /Users/username/projects/my-maven-app && mvn clean package
```

**6. éªŒè¯ç»“æœ**
```
ã€éªŒè¯ç»“æœã€‘
âœ“ æœ¬åœ°éªŒè¯:
  - mvn clean package æˆåŠŸå®Œæˆ
  - target/ç›®å½•ç”Ÿæˆjaræ–‡ä»¶
  - mvn dependency:tree æ— å†²çªè­¦å‘Š

ä»»åŠ¡å®Œæˆ!
```

---

## ä»»åŠ¡ç±»å‹é€‰æ‹©æŒ‡å—

| åœºæ™¯ | ä»»åŠ¡ç±»å‹ | è¯´æ˜ |
|------|---------|------|
| æœåŠ¡å™¨é…ç½®ã€æ—¥å¿—æŸ¥çœ‹ã€æœåŠ¡é‡å¯ | A - çº¯è¿œç¨‹ | ä¸éœ€è¦æœ¬åœ°ä»£ç  |
| åº”ç”¨æŠ¥é”™éœ€è¦çœ‹æºç å®šä½ | B - æœ¬åœ°+è¿œç¨‹ | éœ€è¦å¯¹ç…§ä»£ç å’Œæ—¥å¿— |
| APIå¼‚å¸¸éœ€è¦åˆ†æä»£ç é€»è¾‘ | B - æœ¬åœ°+è¿œç¨‹ | ä»£ç é€»è¾‘ vs è¿è¡ŒçŠ¶æ€ |
| é…ç½®ä¸ä¸€è‡´é—®é¢˜ | B - æœ¬åœ°+è¿œç¨‹ | æœ¬åœ°é…ç½® vs è¿œç¨‹é…ç½® |
| ç‰ˆæœ¬éªŒè¯ | B - æœ¬åœ°+è¿œç¨‹ | æœ¬åœ°ä»£ç  vs è¿œç¨‹éƒ¨ç½² |
| æœ¬åœ°ä»£ç åˆ†æã€æ„å»ºé—®é¢˜ | C - çº¯æœ¬åœ° | ä¸æ¶‰åŠè¿œç¨‹æœåŠ¡å™¨ |
| æœ¬åœ°é…ç½®æ–‡ä»¶ä¿®æ”¹ | C - çº¯æœ¬åœ° | ä»…æœ¬åœ°æ“ä½œ |

---

## å®‰å…¨æç¤º

### âœ… å®‰å…¨æ“ä½œ

æ™®é€šå‘½ä»¤æ‰§è¡Œ:
```bash
./ssh_exec.sh <alias> "ls -la"
./ssh_exec.sh <alias> "cat config.yml"
./ssh_exec.sh <alias> "docker ps"
```

### âš ï¸ éœ€è¦ç¡®è®¤çš„æ“ä½œ

ä»¥ä¸‹æ“ä½œä¼šè§¦å‘ç¡®è®¤æµç¨‹:

```bash
# ä½¿ç”¨sudo
./ssh_exec.sh <alias> "sudo systemctl restart nginx"
â†’ éœ€è¦ç”¨æˆ·å›å¤"ç¡®è®¤æ‰§è¡Œ"

# åˆ é™¤æ–‡ä»¶
./ssh_exec.sh <alias> "rm -rf /tmp/old_data"
â†’ éœ€è¦ç”¨æˆ·å›å¤"ç¡®è®¤æ‰§è¡Œ"

# ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶
./ssh_exec.sh <alias> "vim /etc/nginx/nginx.conf"
â†’ éœ€è¦ç”¨æˆ·å›å¤"ç¡®è®¤æ‰§è¡Œ"
```

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜: SSHè¿æ¥å¤±è´¥

**ç—‡çŠ¶**:
```
Error: Server alias 'xxx' not found in servers.conf
```

**è§£å†³**:
1. æ£€æŸ¥åˆ«åæ‹¼å†™æ˜¯å¦æ­£ç¡®
2. æŸ¥çœ‹å¯ç”¨æœåŠ¡å™¨: `./ssh_exec.sh`
3. ç¡®è®¤ `servers.conf` æ–‡ä»¶å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®

---

### é—®é¢˜: æƒé™è¢«æ‹’ç»

**ç—‡çŠ¶**:
```
Permission denied
```

**è§£å†³**:
1. ç¡®è®¤ç”¨æˆ·æœ‰æ‰§è¡Œæƒé™
2. å¦‚éœ€æ›´é«˜æƒé™,ä½¿ç”¨ `sudo`(ä¼šè§¦å‘ç¡®è®¤æµç¨‹)
3. æ£€æŸ¥æ–‡ä»¶/ç›®å½•çš„æ‰€æœ‰æƒ

---

### é—®é¢˜: å‘½ä»¤æ‰§è¡Œè¶…æ—¶

**ç—‡çŠ¶**:
```
Connection timeout
```

**è§£å†³**:
1. æ£€æŸ¥ç½‘ç»œè¿æ¥: `ping <æœåŠ¡å™¨IP>`
2. ç¡®è®¤SSHç«¯å£å¼€æ”¾: `nc -zv <IP> <ç«¯å£>`
3. æ£€æŸ¥é˜²ç«å¢™è§„åˆ™

---

## æœ€ä½³å®è·µ

### âœ… DO

- ä½¿ç”¨ `servers.conf` ç»Ÿä¸€ç®¡ç†æœåŠ¡å™¨
- é«˜é£é™©æ“ä½œå‰å…ˆå¤‡ä»½
- ä¿®æ”¹é…ç½®åå…ˆæµ‹è¯•,å†åº”ç”¨
- ä¿ç•™æ“ä½œæ—¥å¿—ç”¨äºå®¡è®¡

### âŒ DON'T

- ä¸è¦å°† `servers.conf` æäº¤åˆ°Git
- ä¸è¦è·³è¿‡ç¡®è®¤æµç¨‹æ‰§è¡Œå±é™©æ“ä½œ
- ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒç›´æ¥æµ‹è¯•æœªéªŒè¯çš„å‘½ä»¤
- ä¸è¦ä¿ç•™ä¸å†ä½¿ç”¨çš„æœåŠ¡å™¨å‡­è¯

---

## è¿›é˜¶æŠ€å·§

### æ‰¹é‡æ“ä½œå¤šå°æœåŠ¡å™¨

```bash
# æ–¹æ³•1: Shellå¾ªç¯
for server in prod staging dev; do
    echo "=== Checking $server ==="
    ./ssh_exec.sh $server "docker ps"
done

# æ–¹æ³•2: åˆ›å»ºè‡ªå®šä¹‰è„šæœ¬
# check_all_servers.sh
```

### è¿œç¨‹æ–‡ä»¶ä¼ è¾“

```bash
# ä½¿ç”¨scp(éœ€è¦å•ç‹¬é…ç½®)
scp local_file user@host:/remote/path

# é€šè¿‡SSHä¼ è¾“
cat local_file | ./ssh_exec.sh <alias> "cat > /remote/path/file"
```

---

## è·å–å¸®åŠ©

- **æŸ¥çœ‹å®Œæ•´æ–‡æ¡£**: `README.md`
- **æŸ¥çœ‹Claudeå·¥ä½œæŒ‡å—**: `CLAUDE.md`
- **æŸ¥çœ‹ä»»åŠ¡è®°å½•**: `ä»»åŠ¡è®°å½•_*.md`

---

**å‡†å¤‡å¥½äº†å—? å¼€å§‹ä½ çš„ç¬¬ä¸€ä¸ªè¿ç»´ä»»åŠ¡å§!** ğŸš€
