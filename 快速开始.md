# Remote Worker å¿«é€Ÿå¼€å§‹æŒ‡å—

## 5åˆ†é’Ÿä¸Šæ‰‹

### æ­¥éª¤1: é…ç½®æœåŠ¡å™¨ä¿¡æ¯

**é¦–æ¬¡ä½¿ç”¨**:
```bash
# å¤åˆ¶é…ç½®æ¨¡æ¿
cp servers.conf.template servers.conf

# ç¼–è¾‘é…ç½®æ–‡ä»¶
vim servers.conf  # æˆ–ä½¿ç”¨ä½ å–œæ¬¢çš„ç¼–è¾‘å™¨
```

**é…ç½®æ ¼å¼**:
```
# åˆ«å|ä¸»æœºIP|SSHç«¯å£|ç”¨æˆ·å|å¯†ç 
hawkbit|192.168.77.142|22|hawkbit|YourPassword
prod|10.0.0.100|22|admin|SecretPass
```

### æ­¥éª¤2: æµ‹è¯•è¿æ¥

```bash
# æŸ¥çœ‹å¯ç”¨æœåŠ¡å™¨
./ssh_exec.sh

# æµ‹è¯•è¿æ¥
./ssh_exec.sh hawkbit "pwd"
```

### æ­¥éª¤3: å¼€å§‹è¿ç»´ä»»åŠ¡

**ç¤ºä¾‹: æ£€æŸ¥DockeræœåŠ¡**
```bash
./ssh_exec.sh hawkbit "docker ps"
```

**ç¤ºä¾‹: æŸ¥çœ‹æ—¥å¿—**
```bash
./ssh_exec.sh prod "tail -100 /var/log/nginx/error.log"
```

**ç¤ºä¾‹: é‡å¯æœåŠ¡**
```bash
# æ³¨æ„: é«˜é£é™©æ“ä½œéœ€è¦ç”¨æˆ·ç¡®è®¤
./ssh_exec.sh prod "sudo systemctl restart nginx"
```

---

## å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

### Dockerç›¸å…³
```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
./ssh_exec.sh <alias> "docker ps"

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
./ssh_exec.sh <alias> "docker logs <container_name> --tail 100"

# é‡å¯å®¹å™¨
./ssh_exec.sh <alias> "docker restart <container_name>"

# æŸ¥çœ‹å®¹å™¨å¥åº·çŠ¶æ€
./ssh_exec.sh <alias> "docker inspect <container_name> --format='{{.State.Health.Status}}'"
```

### Nginxç›¸å…³
```bash
# æµ‹è¯•é…ç½®
./ssh_exec.sh <alias> "docker exec <nginx_container> nginx -t"

# é‡è½½é…ç½®
./ssh_exec.sh <alias> "docker exec <nginx_container> nginx -s reload"

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
./ssh_exec.sh <alias> "docker logs <nginx_container> --tail 50 2>&1 | grep error"
```

### ç³»ç»Ÿç›‘æ§
```bash
# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
./ssh_exec.sh <alias> "df -h"

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
./ssh_exec.sh <alias> "free -h"

# æŸ¥çœ‹è¿›ç¨‹
./ssh_exec.sh <alias> "top -bn1 | head -20"

# æŸ¥çœ‹ç½‘ç»œè¿æ¥
./ssh_exec.sh <alias> "netstat -tulpn | grep LISTEN"
```

---

## å·¥ä½œæµç¨‹ç¤ºä¾‹

### åœºæ™¯: æ’æŸ¥Nginxé—®é¢˜

**1. æ”¶åˆ°ä»»åŠ¡**
```
ä»»åŠ¡: æ’æŸ¥ç”Ÿäº§ç¯å¢ƒNginx 502é”™è¯¯
```

**2. è¿æ¥æœåŠ¡å™¨**
```bash
./ssh_exec.sh prod "pwd"
# è¾“å‡º: /home/admin
```

**3. æŸ¥çœ‹NginxçŠ¶æ€**
```bash
./ssh_exec.sh prod "docker ps | grep nginx"
# æ£€æŸ¥å®¹å™¨è¿è¡ŒçŠ¶æ€
```

**4. æŸ¥çœ‹é”™è¯¯æ—¥å¿—**
```bash
./ssh_exec.sh prod "docker logs nginx-prod --tail 100 2>&1 | grep '502\|error'"
```

**5. åˆ†æå¹¶ä¿®å¤**
- æ ¹æ®æ—¥å¿—å®šä½é—®é¢˜
- æå‡ºè§£å†³æ–¹æ¡ˆ(æ–¹æ¡ˆAã€Bç­‰)
- ç”¨æˆ·ç¡®è®¤åæ‰§è¡Œ

**6. éªŒè¯ä¿®å¤**
```bash
./ssh_exec.sh prod "curl -I http://localhost"
# æ£€æŸ¥è¿”å›çŠ¶æ€ç 
```

---

## å®‰å…¨æç¤º

### âœ… å®‰å…¨æ“ä½œ

æ™®é€šå‘½ä»¤æ‰§è¡Œ:
```bash
./ssh_exec.sh <alias> "ls -la"
./ssh_exec.sh <alias> "cat config.yml"
./ssh_exec.sh <alias> "docker ps"
```

### âš ï¸ éœ€è¦ç¡®è®¤çš„æ“ä½œ

ä»¥ä¸‹æ“ä½œä¼šè§¦å‘ç¡®è®¤æµç¨‹:

```bash
# ä½¿ç”¨sudo
./ssh_exec.sh <alias> "sudo systemctl restart nginx"
â†’ éœ€è¦ç”¨æˆ·å›å¤"ç¡®è®¤æ‰§è¡Œ"

# åˆ é™¤æ–‡ä»¶
./ssh_exec.sh <alias> "rm -rf /tmp/old_data"
â†’ éœ€è¦ç”¨æˆ·å›å¤"ç¡®è®¤æ‰§è¡Œ"

# ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶
./ssh_exec.sh <alias> "vim /etc/nginx/nginx.conf"
â†’ éœ€è¦ç”¨æˆ·å›å¤"ç¡®è®¤æ‰§è¡Œ"
```

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜: SSHè¿æ¥å¤±è´¥

**ç—‡çŠ¶**:
```
Error: Server alias 'xxx' not found in servers.conf
```

**è§£å†³**:
1. æ£€æŸ¥åˆ«åæ‹¼å†™æ˜¯å¦æ­£ç¡®
2. æŸ¥çœ‹å¯ç”¨æœåŠ¡å™¨: `./ssh_exec.sh`
3. ç¡®è®¤ `servers.conf` æ–‡ä»¶å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®

---

### é—®é¢˜: æƒé™è¢«æ‹’ç»

**ç—‡çŠ¶**:
```
Permission denied
```

**è§£å†³**:
1. ç¡®è®¤ç”¨æˆ·æœ‰æ‰§è¡Œæƒé™
2. å¦‚éœ€æ›´é«˜æƒé™,ä½¿ç”¨ `sudo`(ä¼šè§¦å‘ç¡®è®¤æµç¨‹)
3. æ£€æŸ¥æ–‡ä»¶/ç›®å½•çš„æ‰€æœ‰æƒ

---

### é—®é¢˜: å‘½ä»¤æ‰§è¡Œè¶…æ—¶

**ç—‡çŠ¶**:
```
Connection timeout
```

**è§£å†³**:
1. æ£€æŸ¥ç½‘ç»œè¿æ¥: `ping <æœåŠ¡å™¨IP>`
2. ç¡®è®¤SSHç«¯å£å¼€æ”¾: `nc -zv <IP> <ç«¯å£>`
3. æ£€æŸ¥é˜²ç«å¢™è§„åˆ™

---

## æœ€ä½³å®è·µ

### âœ… DO

- ä½¿ç”¨ `servers.conf` ç»Ÿä¸€ç®¡ç†æœåŠ¡å™¨
- é«˜é£é™©æ“ä½œå‰å…ˆå¤‡ä»½
- ä¿®æ”¹é…ç½®åå…ˆæµ‹è¯•,å†åº”ç”¨
- ä¿ç•™æ“ä½œæ—¥å¿—ç”¨äºå®¡è®¡

### âŒ DON'T

- ä¸è¦å°† `servers.conf` æäº¤åˆ°Git
- ä¸è¦è·³è¿‡ç¡®è®¤æµç¨‹æ‰§è¡Œå±é™©æ“ä½œ
- ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒç›´æ¥æµ‹è¯•æœªéªŒè¯çš„å‘½ä»¤
- ä¸è¦ä¿ç•™ä¸å†ä½¿ç”¨çš„æœåŠ¡å™¨å‡­è¯

---

## è¿›é˜¶æŠ€å·§

### æ‰¹é‡æ“ä½œå¤šå°æœåŠ¡å™¨

```bash
# æ–¹æ³•1: Shellå¾ªç¯
for server in prod staging dev; do
    echo "=== Checking $server ==="
    ./ssh_exec.sh $server "docker ps"
done

# æ–¹æ³•2: åˆ›å»ºè‡ªå®šä¹‰è„šæœ¬
# check_all_servers.sh
```

### è¿œç¨‹æ–‡ä»¶ä¼ è¾“

```bash
# ä½¿ç”¨scp(éœ€è¦å•ç‹¬é…ç½®)
scp local_file user@host:/remote/path

# é€šè¿‡SSHä¼ è¾“
cat local_file | ./ssh_exec.sh <alias> "cat > /remote/path/file"
```

---

## è·å–å¸®åŠ©

- **æŸ¥çœ‹å®Œæ•´æ–‡æ¡£**: `README.md`
- **æŸ¥çœ‹Claudeå·¥ä½œæŒ‡å—**: `CLAUDE.md`
- **æŸ¥çœ‹ä»»åŠ¡è®°å½•**: `ä»»åŠ¡è®°å½•_*.md`

---

**å‡†å¤‡å¥½äº†å—? å¼€å§‹ä½ çš„ç¬¬ä¸€ä¸ªè¿ç»´ä»»åŠ¡å§!** ğŸš€
